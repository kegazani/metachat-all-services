syntax = "proto3";

package user;

option go_package = "metachat/proto/generated/user";

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

// User service definition
service UserService {
  // User operations
  rpc CreateUser(CreateUserRequest) returns (CreateUserResponse);
  rpc GetUser(GetUserRequest) returns (GetUserResponse);
  rpc UpdateUserProfile(UpdateUserProfileRequest) returns (UpdateUserProfileResponse);
  
  // Archetype operations
  rpc AssignArchetype(AssignArchetypeRequest) returns (AssignArchetypeResponse);
  rpc UpdateArchetype(UpdateArchetypeRequest) returns (UpdateArchetypeResponse);
  
  // Modality operations
  rpc UpdateModalities(UpdateModalitiesRequest) returns (UpdateModalitiesResponse);
  
  // Query operations for read models
  rpc GetUserReadModel(GetUserReadModelRequest) returns (GetUserReadModelResponse);
  rpc GetUserArchetypeReadModel(GetUserArchetypeReadModelRequest) returns (GetUserArchetypeReadModelResponse);
  rpc ListUsers(ListUsersRequest) returns (ListUsersResponse);
}

// User message
message User {
  string id = 1;
  string username = 2;
  string email = 3;
  string first_name = 4;
  string last_name = 5;
  string date_of_birth = 6;
  string avatar = 7;
  string bio = 8;
  Archetype archetype = 9;
  repeated UserModality modalities = 10;
  google.protobuf.Timestamp created_at = 11;
  google.protobuf.Timestamp updated_at = 12;
}

// Archetype message
message Archetype {
  string id = 1;
  string name = 2;
  string description = 3;
  double confidence = 4;
}

// UserModality message
message UserModality {
  string id = 1;
  string name = 2;
  string type = 3;
  bool enabled = 4;
  double weight = 5;
}

// UserReadModel message
message UserReadModel {
  string id = 1;
  string username = 2;
  string email = 3;
  string first_name = 4;
  string last_name = 5;
  string full_name = 6;
  string avatar = 7;
  string bio = 8;
  google.protobuf.Timestamp created_at = 9;
  google.protobuf.Timestamp updated_at = 10;
}

// UserArchetypeReadModel message
message UserArchetypeReadModel {
  string id = 1;
  string archetype_id = 2;
  string archetype_name = 3;
  string description = 4;
  double confidence = 5;
  google.protobuf.Timestamp assigned_at = 6;
  google.protobuf.Timestamp updated_at = 7;
}

// Request/Response messages
message CreateUserRequest {
  string username = 1;
  string email = 2;
  string first_name = 3;
  string last_name = 4;
  string date_of_birth = 5;
}

message CreateUserResponse {
  User user = 1;
}

message GetUserRequest {
  string id = 1;
}

message GetUserResponse {
  User user = 1;
}

message UpdateUserProfileRequest {
  string id = 1;
  string first_name = 2;
  string last_name = 3;
  string date_of_birth = 4;
  string avatar = 5;
  string bio = 6;
}

message UpdateUserProfileResponse {
  User user = 1;
}

message AssignArchetypeRequest {
  string id = 1;
  string archetype_id = 2;
  string archetype_name = 3;
  double confidence = 4;
  string description = 5;
}

message AssignArchetypeResponse {
  User user = 1;
}

message UpdateArchetypeRequest {
  string id = 1;
  string archetype_id = 2;
  string archetype_name = 3;
  double confidence = 4;
  string description = 5;
}

message UpdateArchetypeResponse {
  User user = 1;
}

message UpdateModalitiesRequest {
  string id = 1;
  repeated UserModality modalities = 2;
}

message UpdateModalitiesResponse {
  User user = 1;
}

message GetUserReadModelRequest {
  string id = 1;
}

message GetUserReadModelResponse {
  UserReadModel user = 1;
}

message GetUserArchetypeReadModelRequest {
  string id = 1;
}

message GetUserArchetypeReadModelResponse {
  UserArchetypeReadModel user_archetype = 1;
}

message ListUsersRequest {
  int32 page = 1;
  int32 limit = 2;
  string filter = 3;
}

message ListUsersResponse {
  repeated User users = 1;
  int32 total = 2;
  int32 page = 3;
  int32 limit = 4;
}