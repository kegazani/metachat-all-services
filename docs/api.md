# API Документация MetaChat

## Обзор

MetaChat предоставляет RESTful API для взаимодействия с системой. API доступен через API Gateway и требует аутентификации с использованием JWT токенов.

## Базовый URL

```
https://api.metachat.com/v1
```

## Аутентификация

Все запросы к API должны содержать JWT токен в заголовке Authorization:

```
Authorization: Bearer <your-jwt-token>
```

## Пользователи (User Service)

### Регистрация пользователя

Создает нового пользователя в системе.

**Запрос:**
```
POST /users/register
```

**Тело запроса:**
```json
{
  "email": "user@example.com",
  "password": "securepassword",
  "name": "Иван Петров",
  "birthdate": "1990-01-01"
}
```

**Ответ:**
```json
{
  "id": "user_123456",
  "email": "user@example.com",
  "name": "Иван Петров",
  "birthdate": "1990-01-01",
  "created_at": "2023-12-01T10:00:00Z"
}
```

### Аутентификация пользователя

Выполняет вход пользователя и возвращает JWT токен.

**Запрос:**
```
POST /users/login
```

**Тело запроса:**
```json
{
  "email": "user@example.com",
  "password": "securepassword"
}
```

**Ответ:**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 3600
}
```

### Получение информации о пользователе

Возвращает информацию о пользователе по его ID.

**Запрос:**
```
GET /users/{id}
```

**Ответ:**
```json
{
  "id": "user_123456",
  "email": "user@example.com",
  "name": "Иван Петров",
  "birthdate": "1990-01-01",
  "created_at": "2023-12-01T10:00:00Z",
  "updated_at": "2023-12-01T10:00:00Z"
}
```

### Получение портрета пользователя

Возвращает портрет пользователя, включая эмоциональный профиль, личностные черты, интересы и модальности.

**Запрос:**
```
GET /users/{id}/portrait
```

**Ответ:**
```json
{
  "user_id": "user_123456",
  "mood_profile": {
    "joy": 0.7,
    "sadness": 0.1,
    "anger": 0.05,
    "fear": 0.05,
    "surprise": 0.05,
    "disgust": 0.05
  },
  "personality_traits": {
    "openness": 0.8,
    "conscientiousness": 0.7,
    "extraversion": 0.6,
    "agreeableness": 0.9,
    "neuroticism": 0.3
  },
  "interests": ["музыка", "чтение", "путешествия", "технологии"],
  "modalities": {
    "visual": 0.8,
    "auditory": 0.6,
    "kinesthetic": 0.4
  },
  "updated_at": "2023-12-01T10:00:00Z"
}
```

### Обновление портрета пользователя

Обновляет портрет пользователя.

**Запрос:**
```
PUT /users/{id}/portrait
```

**Тело запроса:**
```json
{
  "mood_profile": {
    "joy": 0.75,
    "sadness": 0.08,
    "anger": 0.04,
    "fear": 0.04,
    "surprise": 0.04,
    "disgust": 0.05
  },
  "personality_traits": {
    "openness": 0.82,
    "conscientiousness": 0.72,
    "extraversion": 0.62,
    "agreeableness": 0.88,
    "neuroticism": 0.28
  },
  "interests": ["музыка", "чтение", "путешествия", "технологии", "искусство"],
  "modalities": {
    "visual": 0.82,
    "auditory": 0.62,
    "kinesthetic": 0.42
  }
}
```

**Ответ:**
```json
{
  "user_id": "user_123456",
  "mood_profile": {
    "joy": 0.75,
    "sadness": 0.08,
    "anger": 0.04,
    "fear": 0.04,
    "surprise": 0.04,
    "disgust": 0.05
  },
  "personality_traits": {
    "openness": 0.82,
    "conscientiousness": 0.72,
    "extraversion": 0.62,
    "agreeableness": 0.88,
    "neuroticism": 0.28
  },
  "interests": ["музыка", "чтение", "путешествия", "технологии", "искусство"],
  "modalities": {
    "visual": 0.82,
    "auditory": 0.62,
    "kinesthetic": 0.42
  },
  "updated_at": "2023-12-01T11:00:00Z"
}
```

## Дневник (Diary Service)

### Создание записи в дневнике

Создает новую запись в дневнике пользователя.

**Запрос:**
```
POST /diary/entries
```

**Тело запроса:**
```json
{
  "title": "Хороший день",
  "content": "Сегодня был очень продуктивный день. Я закончил проект, над которым работал уже несколько недель.",
  "mood": "happy",
  "tags": ["работа", "проект", "успех"]
}
```

**Ответ:**
```json
{
  "id": "entry_123456",
  "user_id": "user_123456",
  "title": "Хороший день",
  "content": "Сегодня был очень продуктивный день. Я закончил проект, над которым работал уже несколько недель.",
  "mood": "happy",
  "tags": ["работа", "проект", "успех"],
  "created_at": "2023-12-01T10:00:00Z",
  "updated_at": "2023-12-01T10:00:00Z"
}
```

### Получение записей дневника

Возвращает список записей дневника пользователя с возможностью фильтрации и пагинации.

**Запрос:**
```
GET /diary/entries
```

**Параметры запроса:**
- `page` (int, optional): Номер страницы (по умолчанию: 1)
- `limit` (int, optional): Количество записей на странице (по умолчанию: 10, максимум: 100)
- `start_date` (string, optional): Начальная дата в формате YYYY-MM-DD
- `end_date` (string, optional): Конечная дата в формате YYYY-MM-DD
- `mood` (string, optional): Фильтр по настроению (happy, sad, angry, fearful, surprised, disgusted, neutral, thoughtful)
- `tag` (string, optional): Фильтр по тегу

**Ответ:**
```json
{
  "entries": [
    {
      "id": "entry_123456",
      "user_id": "user_123456",
      "title": "Хороший день",
      "content": "Сегодня был очень продуктивный день. Я закончил проект, над которым работал уже несколько недель.",
      "mood": "happy",
      "tags": ["работа", "проект", "успех"],
      "created_at": "2023-12-01T10:00:00Z",
      "updated_at": "2023-12-01T10:00:00Z"
    },
    {
      "id": "entry_789012",
      "user_id": "user_123456",
      "title": "Размышления о будущем",
      "content": "Иногда задумываюсь о том, что ждет меня впереди. Хочется верить, что все будет хорошо.",
      "mood": "thoughtful",
      "tags": ["будущее", "размышления"],
      "created_at": "2023-11-30T18:30:00Z",
      "updated_at": "2023-11-30T18:30:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 25,
    "pages": 3
  }
}
```

### Получение записи дневника по ID

Возвращает запись дневника по ее ID.

**Запрос:**
```
GET /diary/entries/{id}
```

**Ответ:**
```json
{
  "id": "entry_123456",
  "user_id": "user_123456",
  "title": "Хороший день",
  "content": "Сегодня был очень продуктивный день. Я закончил проект, над которым работал уже несколько недель.",
  "mood": "happy",
  "tags": ["работа", "проект", "успех"],
  "created_at": "2023-12-01T10:00:00Z",
  "updated_at": "2023-12-01T10:00:00Z"
}
```

### Обновление записи дневника

Обновляет существующую запись в дневнике.

**Запрос:**
```
PUT /diary/entries/{id}
```

**Тело запроса:**
```json
{
  "title": "Отличный день",
  "content": "Сегодня был очень продуктивный день. Я закончил проект, над которым работал уже несколько недель. Чувствую себя счастливым!",
  "mood": "happy",
  "tags": ["работа", "проект", "успех", "счастье"]
}
```

**Ответ:**
```json
{
  "id": "entry_123456",
  "user_id": "user_123456",
  "title": "Отличный день",
  "content": "Сегодня был очень продуктивный день. Я закончил проект, над которым работал уже несколько недель. Чувствую себя счастливым!",
  "mood": "happy",
  "tags": ["работа", "проект", "успех", "счастье"],
  "created_at": "2023-12-01T10:00:00Z",
  "updated_at": "2023-12-01T11:00:00Z"
}
```

### Удаление записи дневника

Удаляет существующую запись в дневнике.

**Запрос:**
```
DELETE /diary/entries/{id}
```

**Ответ:**
```json
{
  "success": true,
  "message": "Запись успешно удалена"
}
```

## Мэтчинг (Matching Service)

### Поиск похожих пользователей

Находит пользователей, похожих на указанного пользователя, на основе их портретов.

**Запрос:**
```
GET /users/{id}/similar
```

**Параметры запроса:**
- `limit` (int, optional): Максимальное количество результатов (по умолчанию: 10, максимум: 100)

**Ответ:**
```json
{
  "matches": [
    {
      "user_id1": "user_123456",
      "user_id2": "user_789012",
      "similarity": 0.85,
      "common_interests": ["музыка", "путешествия"],
      "created_at": "2023-12-01T10:00:00Z"
    },
    {
      "user_id1": "user_123456",
      "user_id2": "user_345678",
      "similarity": 0.72,
      "common_interests": ["чтение", "технологии"],
      "created_at": "2023-12-01T10:00:00Z"
    }
  ]
}
```

### Расчет схожести пользователей

Рассчитывает степень схожести между двумя пользователями.

**Запрос:**
```
GET /users/{id1}/similarity/{id2}
```

**Ответ:**
```json
{
  "user_id1": "user_123456",
  "user_id2": "user_789012",
  "similarity": 0.85
}
```

### Получение мэтчей пользователя

Возвращает все мэтчи для указанного пользователя.

**Запрос:**
```
GET /users/{id}/matches
```

**Ответ:**
```json
{
  "matches": [
    {
      "user_id1": "user_123456",
      "user_id2": "user_789012",
      "similarity": 0.85,
      "common_interests": ["музыка", "путешествия"],
      "created_at": "2023-12-01T10:00:00Z"
    },
    {
      "user_id1": "user_123456",
      "user_id2": "user_345678",
      "similarity": 0.72,
      "common_interests": ["чтение", "технологии"],
      "created_at": "2023-12-01T10:00:00Z"
    }
  ]
}
```

## Рекомендации (Recommendation Service)

### Получение рекомендаций контента

Возвращает рекомендации контента для пользователя на основе его портрета.

**Запрос:**
```
GET /users/{id}/recommendations/content
```

**Параметры запроса:**
- `limit` (int, optional): Максимальное количество результатов (по умолчанию: 10, максимум: 100)

**Ответ:**
```json
{
  "recommendations": [
    {
      "content": {
        "id": "content_123456",
        "title": "Понимание эмоционального интеллекта",
        "description": "Узнайте о важности эмоционального интеллекта в личных и профессиональных отношениях.",
        "type": "article",
        "tags": ["психология", "эмоции", "саморазвитие"],
        "created_at": "2023-12-01T10:00:00Z"
      },
      "score": 0.9,
      "reason": "похоже на ваши интересы"
    },
    {
      "content": {
        "id": "content_789012",
        "title": "Сила уязвимости",
        "description": "Выступление Брене Браун о силе уязвимости в человеческих связях.",
        "type": "video",
        "tags": ["психология", "уязвимость", "связи"],
        "created_at": "2023-12-01T10:00:00Z"
      },
      "score": 0.8,
      "reason": "похоже на ваши интересы"
    }
  ]
}
```

### Получение рекомендаций пользователей

Возвращает рекомендации пользователей для пользователя на основе схожести портретов.

**Запрос:**
```
GET /users/{id}/recommendations/users
```

**Параметры запроса:**
- `limit` (int, optional): Максимальное количество результатов (по умолчанию: 10, максимум: 100)

**Ответ:**
```json
{
  "matches": [
    {
      "user_id1": "user_123456",
      "user_id2": "user_789012",
      "similarity": 0.85,
      "common_interests": ["музыка", "путешествия"],
      "created_at": "2023-12-01T10:00:00Z"
    },
    {
      "user_id1": "user_123456",
      "user_id2": "user_345678",
      "similarity": 0.72,
      "common_interests": ["чтение", "технологии"],
      "created_at": "2023-12-01T10:00:00Z"
    }
  ]
}
```

### Получение похожего контента

Возвращает контент, похожий на указанный.

**Запрос:**
```
GET /content/{id}/similar
```

**Параметры запроса:**
- `limit` (int, optional): Максимальное количество результатов (по умолчанию: 10, максимум: 100)

**Ответ:**
```json
{
  "content": [
    {
      "id": "content_123456",
      "title": "Понимание эмоционального интеллекта",
      "description": "Узнайте о важности эмоционального интеллекта в личных и профессиональных отношениях.",
      "type": "article",
      "tags": ["психология", "эмоции", "саморазвитие"],
      "created_at": "2023-12-01T10:00:00Z"
    },
    {
      "id": "content_789012",
      "title": "Эмоциональный интеллект в бизнесе",
      "description": "Как эмоциональный интеллект помогает в достижении успеха в бизнесе.",
      "type": "article",
      "tags": ["психология", "эмоции", "бизнес"],
      "created_at": "2023-12-01T10:00:00Z"
    }
  ]
}
```

## Коды ошибок

| Код | Описание |
|-----|----------|
| 200 | OK - Запрос выполнен успешно |
| 201 | Created - Ресурс успешно создан |
| 400 | Bad Request - Неверный формат запроса |
| 401 | Unauthorized - Требуется аутентификация |
| 403 | Forbidden - Доступ запрещен |
| 404 | Not Found - Ресурс не найден |
| 422 | Unprocessable Entity - Ошибка валидации данных |
| 429 | Too Many Requests - Превышен лимит запросов |
| 500 | Internal Server Error - Внутренняя ошибка сервера |
| 503 | Service Unavailable - Сервис временно недоступен |

## Ограничения

- Максимальное количество запросов в минут: 60
- Максимальный размер тела запроса: 10MB
- Максимальное количество записей на странице: 100